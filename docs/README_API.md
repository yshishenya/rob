# Руководство по использованию API

## Введение

Данное руководство предназначено для фронтенд-разработчиков и описывает основные маршруты для взаимодействия с бэкендом через API. Все запросы к API должны быть авторизованы с использованием токена доступа.

## Аутентификация

### Получение токенов

Для выполнения аутентификации и получения токенов доступа и обновления, отправьте POST-запрос на `/api/login`, указав имя пользователя и пароль в теле запроса в формате JSON.

```bash
curl -X POST https://dev.volter.pro-4.ru/api/login \
 -H "Content-Type: application/json" \
 -d '{"username":"user", "password":"password"}'
```

В ответе вы получите два токена: `access_token` для доступа к защищенным маршрутам и `refresh_token` для обновления `access_token` по его истечении.

### Использование access_token

Для доступа к защищенным маршрутам API включите полученный `access_token` в заголовок Authorization запроса. `access_token` имеет ограниченный срок действия (1 час).

```python
import requests

url = "https://example.com/api/маршрут"
access_token = "ваш_access_token"

headers = {
    "Authorization": f"Bearer {access_token}"
}

response = requests.get(url, headers=headers)

print(response.text)
```

### Примеры получения ответа при аутентификации

После успешного выполнения запроса на аутентификацию, API возвращает JSON с токенами.

```json
{
  "access_token": "eyJ0еXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJleHAiOjE2MDc5MzU2MDB9.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c",
  "expires_at": "2023-04-12T12:00:00Z",
  "refresh_token": "def50200d13897d85e02c8c2c0a5...",
  "refresh_token_expires_at": "2023-05-12T12:00:00Z"
}
```

## Обновление токена доступа

### Использование refresh_token

Когда срок действия `access_token` подходит к концу, вы можете использовать `refresh_token` для получения нового токена доступа. Для этого отправьте POST-запрос на `/api/refresh`, передав `refresh_token` в теле запроса.

```bash
curl -X POST https://dev.volter.pro-4.ru/api/refresh \
 -H "Content-Type: application/json" \
 -d '{"refresh_token":"<ваш_refresh_token>"}'
```

В ответ на успешный запрос вы получите новый `access_token` с обновленным сроком действия.

### Пример успешного ответа:

После успешного выполнения запроса на обновление токена доступа, вы получите JSON с новым `access_token`.

```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoyLCJleHAiOjE2MDc5NDIwMDB9.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5d",
  "expires_at": "2023-04-12T14:00:00Z"
}
```

### Ошибки

В случае ошибки, например, при использовании недействительных учетных данных или истекшего `refresh_token`, сервер вернет соответствующее сообщение об ошибке.

```json
{
  "error": "Invalid or expired refresh token"
}
```

## Работа с текстом через API

### Отправка текста

Для отправки текста на сервер используйте маршрут POST `/api/input-text`, передав текст в теле запроса в формате JSON. Этот запрос также должен быть авторизован с помощью `access_token`.

```bash
curl -X POST https://dev.volter.pro-4.ru/api/input-text \
 -H "Content-Type: application/json" \
 -H "Authorization: Bearer <access_token>" \
 -d '{"text": "Пример текста для отправки"}'
```

В ответ сервер вернет тот же текст в формате JSON.

### Задать вопрос GPT

Для задания вопроса GPT и получения ответа используйте маршрут POST `/api/ask-question`, передав параметры запроса в формате JSON.

```bash
curl -X POST https://dev.volter.pro-4.ru/api/ask-question \
 -H "Content-Type: application/json" \
 -H "Authorization: Bearer <access_token>" \
 -d '{"prompt_text": "Какой сегодня день?", "model": "gpt-3.5-turbo", "temperature": 0.7, "top_p": 1, "max_tokens": 100}'
```

Пример ответа от API:

```json
{
  "response": "Сегодня среда, 12 апреля 2023 года."
}
```

## Работа с аудио через API

### Транскрибация аудиофайлов

Если необходимо преобразовать аудиофайл в текст, воспользуйтесь маршрутом POST `/api/transcribe`. Для этого отправьте файл в формате `multipart/form-data`.

```bash
curl -X POST https://dev.volter.pro-4.ru/api/transcribe \
 -H "Authorization: Bearer <access_token>" \
 -F "file=@путь_к_вашему_файлу"
```

_Замечание:_ Следует указать правильный путь к аудиофайлу, который вы хотите транскрибировать. После успешной загрузки и транскрибации файла, сервер вернет результат в формате JSON.

### Пример успешного ответа:

В ответ на запрос транскрибации вы получите текст, извлеченный из аудио.

```json
{
  "text": "Транскрибированный текст из аудиофайла."
}
```

### Обработка ошибок

В случае возникновения ошибки при загрузке файла или его обработке, сервер вернет сообщение об ошибке и статус код.

```json
{
  "error": "No file part"
}
```

или

```json
{
  "error": "No selected file"
}
```

## Общие замечания по использованию API

### Аутентификация и токены доступа

- **Аутентификация:** Почти все запросы к API, кроме маршрутов аутентификации (`/api/login` и `/api/refresh`), требуют предоставления валидного `access_token` в заголовке `Authorization` с префиксом `Bearer`.

- **Обновление токена:** При истечении срока действия `access_token`, используйте `refresh_token` для его обновления. Это помогает поддерживать сеанс пользователя без необходимости повторного ввода учетных данных.

### Сроки действия токенов

- **`access_token`:** Имеет ограничение по времени (обычно 1 час). По его истечении необходимо его обновить, используя `refresh_token`.

- **`refresh_token`:** Обладает более длительным сроком действия по сравнению с `access_token` (обычно 30 дней), позволяя получить новый `access_token` без повторной аутентификации пользователя.

### Принципы безопасности

Все запросы к API должны проходить через HTTPS для обеспечения защиты данных пользователя и предотвращения возможного перехвата чувствительной информации. Безопасное взаимодействие с API гарантирует конфиденциальность и целостность передаваемых данных.

Это руководство предоставляет обзор ключевых маршрутов API и должно использоваться как основа для разработчиков при создании клиентской части приложения, потребляющего данный API.
