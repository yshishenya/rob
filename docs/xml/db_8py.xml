<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.10.0" xml:lang="en-US">
  <compounddef id="db_8py" kind="file" language="Python">
    <compoundname>db.py</compoundname>
    <innerclass refid="classbackend_1_1db_1_1User" prot="public">backend::db::User</innerclass>
    <innernamespace refid="namespacebackend">backend</innernamespace>
    <innernamespace refid="namespacebackend_1_1db">backend::db</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespacebackend" refkind="compound"><highlight class="keyword">from</highlight><highlight class="normal"><sp/>sqlalchemy<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>create_engine,<sp/>Column,<sp/>Integer,<sp/>String,<sp/>Boolean,<sp/>DateTime,<sp/>ForeignKey</highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>sqlalchemy.ext.declarative<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>declarative_base</highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>sqlalchemy.orm<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>sessionmaker,<sp/>relationship,<sp/>backref</highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>werkzeug.security<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>generate_password_hash,<sp/>check_password_hash</highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>os</highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>logging</highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>dotenv<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>load_dotenv</highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Настройка<sp/>логирования</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10" refid="namespacebackend_1_1db_1a12e4627d89ec45bd8387dec506627a0b" refkind="member"><highlight class="normal">logging.basicConfig(level=logging.INFO)</highlight></codeline>
<codeline lineno="11" refid="namespacebackend_1_1db_1a7bf12892f824b7a3da5c6cb6e4e30ce5" refkind="member"><highlight class="normal">logger<sp/>=<sp/>logging.getLogger(__name__)</highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Загрузка<sp/>переменных<sp/>окружения</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal">load_dotenv()</highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Получение<sp/>переменных<sp/>окружения<sp/>для<sp/>подключения<sp/>к<sp/>базе<sp/>данных<sp/>с<sp/>заданием<sp/>значений<sp/>по<sp/>умолчанию</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17" refid="namespacebackend_1_1db_1a2c81f46a6c0833e0e7d1b21bd816234b" refkind="member"><highlight class="normal">POSTGRES_USER<sp/>=<sp/>os.getenv(</highlight><highlight class="stringliteral">&quot;POSTGRES_USER&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;default_user&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="18" refid="namespacebackend_1_1db_1a2328c07abd416fb91dbfb10c33b98b3c" refkind="member"><highlight class="normal">POSTGRES_PASSWORD<sp/>=<sp/>os.getenv(</highlight><highlight class="stringliteral">&quot;POSTGRES_PASSWORD&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;default_password&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="19" refid="namespacebackend_1_1db_1a10c4e3657b51825bdb57f8b8e4f51f18" refkind="member"><highlight class="normal">POSTGRES_DB<sp/>=<sp/>os.getenv(</highlight><highlight class="stringliteral">&quot;POSTGRES_DB&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;default_db&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="20" refid="namespacebackend_1_1db_1a3f77cd852989af7c147aebe846e4d290" refkind="member"><highlight class="normal">POSTGRES_HOST<sp/>=<sp/>os.getenv(</highlight><highlight class="stringliteral">&quot;POSTGRES_HOST&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;localhost&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="21" refid="namespacebackend_1_1db_1a03c2448ae52310081c8c2299c5a68885" refkind="member"><highlight class="normal">POSTGRES_PORT<sp/>=<sp/>os.getenv(</highlight><highlight class="stringliteral">&quot;POSTGRES_PORT&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;5432&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Настройка<sp/>подключения<sp/>к<sp/>базе<sp/>данных</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26" refid="namespacebackend_1_1db_1a2712f6a35719e12a41eb5c87bffcea74" refkind="member"><highlight class="normal">DATABASE_URL<sp/>=<sp/>f</highlight><highlight class="stringliteral">&quot;postgresql://{os.getenv(&apos;POSTGRES_USER&apos;)}:{os.getenv(&apos;POSTGRES_PASSWORD&apos;)}@{os.getenv(&apos;POSTGRES_HOST&apos;)}:{os.getenv(&apos;POSTGRES_PORT&apos;)}/{os.getenv(&apos;POSTGRES_DB&apos;)}&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27" refid="namespacebackend_1_1db_1a33e6267c091c7fc29397fa9666cd25b5" refkind="member"><highlight class="normal">engine<sp/>=<sp/>create_engine(DATABASE_URL)</highlight></codeline>
<codeline lineno="28" refid="namespacebackend_1_1db_1a0b318ee468d301d1808f4f6c49ada651" refkind="member"><highlight class="normal">SessionLocal<sp/>=<sp/>sessionmaker(autocommit=</highlight><highlight class="keyword">False</highlight><highlight class="normal">,<sp/>autoflush=</highlight><highlight class="keyword">False</highlight><highlight class="normal">,<sp/>bind=engine)</highlight></codeline>
<codeline lineno="29" refid="namespacebackend_1_1db_1a036b7ab6f207c3287b0668774b089dd0" refkind="member"><highlight class="normal">Base<sp/>=<sp/>declarative_base()</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight></codeline>
<codeline lineno="31" refid="classbackend_1_1db_1_1User" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classbackend_1_1db_1_1User" kindref="compound">User</ref>(<ref refid="classBase" kindref="compound">Base</ref>):</highlight></codeline>
<codeline lineno="32" refid="classbackend_1_1db_1_1User_1a2a7afdccbdd98ce80ba9445eda2eddf8" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>__tablename__<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;user&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33" refid="classbackend_1_1db_1_1User_1a0961dd5989b805b2326170f1db7ddfbb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>id<sp/>=<sp/>Column(Integer,<sp/>primary_key=</highlight><highlight class="keyword">True</highlight><highlight class="normal">,<sp/>index=</highlight><highlight class="keyword">True</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="34" refid="classbackend_1_1db_1_1User_1a5023fa9e4da1d4253434a7fce002ba10" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>username<sp/>=<sp/>Column(String,<sp/>unique=</highlight><highlight class="keyword">True</highlight><highlight class="normal">,<sp/>index=</highlight><highlight class="keyword">True</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="35" refid="classbackend_1_1db_1_1User_1a8a4108d863222635a597c841ce7bedd6" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>password_hash<sp/>=<sp/>Column(String,<sp/>nullable=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="36" refid="classbackend_1_1db_1_1User_1ac9dbd0a9355fb699399f49e4854775f1" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>email<sp/>=<sp/>Column(String,<sp/>unique=</highlight><highlight class="keyword">True</highlight><highlight class="normal">,<sp/>index=</highlight><highlight class="keyword">True</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="37" refid="classbackend_1_1db_1_1User_1a5c3f597a861c93d59cd756e5ecb214a9" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>is_admin<sp/>=<sp/>Column(Boolean,<sp/>default=</highlight><highlight class="keyword">False</highlight><highlight class="normal">,<sp/>nullable=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight></codeline>
<codeline lineno="39" refid="classbackend_1_1db_1_1User_1a398a54bc53a26938573dfca506a13c5c" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classbackend_1_1db_1_1User_1a398a54bc53a26938573dfca506a13c5c" kindref="member">set_password</ref>(self,<sp/>password):</highlight></codeline>
<codeline lineno="40"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classbackend_1_1db_1_1User_1a8a4108d863222635a597c841ce7bedd6" kindref="member">password_hash</ref><sp/>=<sp/>generate_password_hash(password)</highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight></codeline>
<codeline lineno="42" refid="classbackend_1_1db_1_1User_1a2b26b10e4cef8e28529000b96380ed65" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classbackend_1_1db_1_1User_1a2b26b10e4cef8e28529000b96380ed65" kindref="member">check_password</ref>(self,<sp/>password):</highlight></codeline>
<codeline lineno="43"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>check_password_hash(self.<ref refid="classbackend_1_1db_1_1User_1a8a4108d863222635a597c841ce7bedd6" kindref="member">password_hash</ref>,<sp/>password)</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="comment">#<sp/>class<sp/>Token(Base):</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/>__tablename__<sp/>=<sp/>&quot;token&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/>id<sp/>=<sp/>Column(Integer,<sp/>primary_key=True,<sp/>index=True)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/>token<sp/>=<sp/>Column(String,<sp/>unique=True,<sp/>index=True)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/>user_id<sp/>=<sp/>Column(Integer,<sp/>ForeignKey(&apos;user.id&apos;),<sp/>index=True)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/>user<sp/>=<sp/>relationship(&apos;User&apos;,<sp/>backref=backref(&apos;tokens&apos;,<sp/>lazy=True))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/>expires_at<sp/>=<sp/>Column(DateTime,<sp/>nullable=False)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight><highlight class="comment">#<sp/>class<sp/>RefreshToken(Base):</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/>__tablename__<sp/>=<sp/>&quot;refresh_token&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/>id<sp/>=<sp/>Column(Integer,<sp/>primary_key=True,<sp/>index=True)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/>refresh_token<sp/>=<sp/>Column(String,<sp/>unique=True,<sp/>index=True)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/>user_id<sp/>=<sp/>Column(Integer,<sp/>ForeignKey(&apos;user.id&apos;),<sp/>index=True)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/>user<sp/>=<sp/>relationship(&apos;User&apos;,<sp/>backref=backref(&apos;refresh_tokens&apos;,<sp/>lazy=True))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/><sp/><sp/>expires_at<sp/>=<sp/>Column(DateTime,<sp/>nullable=False)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61" refid="namespacebackend_1_1db_1a531d50d0e97c20ce2de9118403d355c8" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacebackend_1_1db_1a531d50d0e97c20ce2de9118403d355c8" kindref="member">get_db</ref>():</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/>db<sp/>=<sp/><ref refid="namespacebackend_1_1db_1a0b318ee468d301d1808f4f6c49ada651" kindref="member">SessionLocal</ref>()</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">yield</highlight><highlight class="normal"><sp/>db</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">finally</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>db.close()</highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight></codeline>
<codeline lineno="68" refid="namespacebackend_1_1db_1aede5ea7cecfbb5e666435bbf5fad8735" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacebackend_1_1db_1aede5ea7cecfbb5e666435bbf5fad8735" kindref="member">init_db</ref>():</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/>Base.metadata.create_all(bind=engine)</highlight></codeline>
    </programlisting>
    <location file="/tmp/github_repos_arch_doc_gen/yshishenya/rob/backend/db.py"/>
  </compounddef>
</doxygen>
